---
- name: Configure
  replace:
    dest: "{{ phpvirtualbox.path }}/config.php"
    regexp: '^var \${{ item.search }}.*;$'
    replace: "var ${{ item.search }} = '{{ item.replace }}';"
  with_items:
    - search: "username"
      replace: "{{ phpvirtualbox.user.user }}"

    - search: "password"
      replace: "{{ phpvirtualbox.user.pass }}"

    - search: "vrdeports"
      replace: "9001-9100"

- name: Create user
  user:
    name: "{{ phpvirtualbox.user.user }}"
    password: "{{ phpvirtualbox.user.pass | password_hash('sha512') }}"

- name: Configure service
  template:
    src: phpvirtualbox.j2
    dest: /etc/default/virtualbox

- name: Restart service
  service:
    name: vboxweb-service
    state: restarted
    enabled: yes
